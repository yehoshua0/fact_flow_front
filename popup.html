<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FactFlow</title>
  <link rel="stylesheet" href="popup.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="./favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="./assets/favicon.svg" />
  <link rel="shortcut icon" href="./assets/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="./assets/apple-touch-icon.png" />
  <link rel="manifest" href="./assets/site.webmanifest" />
</head>
<body>
  <div class="popup-container">
    <!-- Authentication State (shown when not logged in) -->
    <div class="auth-container hidden" id="auth-container">
      <!-- Auth Header -->
      <header class="auth-header">
        <div class="logo">
          <div class="logo-icon"><img src="./assets/icon.png" alt="FactFlow logo" width="30" height="30"></div>
          <span class="logo-text">FactFlow</span>
        </div>
      </header>

      <!-- Auth Tabs -->
      <nav class="auth-tabs">
        <button class="auth-tab-btn active" data-auth-tab="signin" type="button">Sign In</button>
        <button class="auth-tab-btn" data-auth-tab="signup" type="button">Sign Up</button>
      </nav>

      <!-- Sign In Form -->
      <div class="auth-content" id="signin-auth-tab">
        <form class="auth-form" id="signin-form">
          <div class="form-group">
            <label for="signin-email">Email</label>
            <input type="email" id="signin-email" required>
          </div>
          <div class="form-group">
            <label for="signin-password">Password</label>
            <input type="password" id="signin-password" required>
          </div>
          <button type="submit" class="auth-btn primary">Sign In</button>
          <div class="auth-links">
            <button type="button" class="link-btn" id="forgot-password-btn">Forgot Password?</button>
          </div>
        </form>
      </div>

      <!-- Sign Up Form -->
      <div class="auth-content hidden" id="signup-auth-tab">
        <form class="auth-form" id="signup-form">
          <div class="form-group">
            <label for="signup-name">Display Name</label>
            <input type="text" id="signup-name" required>
          </div>
          <div class="form-group">
            <label for="signup-email">Email</label>
            <input type="email" id="signup-email" required>
          </div>
          <div class="form-group">
            <label for="signup-password">Password</label>
            <input type="password" id="signup-password" required minlength="6">
          </div>
          <div class="form-group">
            <label for="signup-confirm-password">Confirm Password</label>
            <input type="password" id="signup-confirm-password" required>
          </div>
          <button type="submit" class="auth-btn primary">Create Account</button>
          <div class="auth-terms">
            <small>By creating an account, you agree to our Terms of Service and Privacy Policy.</small>
          </div>
        </form>
      </div>

      <!-- Auth Messages -->
      <div class="auth-message hidden" id="auth-message">
        <span class="message-text"></span>
      </div>
    </div>

    <!-- Main App Container (shown when logged in) -->
    <div class="main-container" id="main-container">
      <!-- Header -->
      <header class="popup-header">
        <div class="logo">
          <div class="logo-icon"><img src="./assets/icon.png" alt="FactFlow logo" width="30" height="30"></div>
          <span class="logo-text">FactFlow</span>
        </div>
        <div class="status-indicator" id="status-indicator"></div>
      </header>

      <!-- Navigation Tabs -->
      <nav class="tabs">
        <button class="tab-btn active" data-tab="analysis" type="button">Analyze</button>
        <button class="tab-btn" data-tab="profile" type="button">Profile</button>
      </nav>

      <!-- Analysis Tab Content -->
      <div class="tab-content" id="analysis-tab">
        <!-- Initial State - Analyze Button -->
        <div class="analyze-state" id="analyze-state">
          <div class="analyze-prompt">
            <div class="analyze-icon">üîç</div>
            <h3>Ready to analyze</h3>
            <p>Click the button below to analyze the current article for reliability and bias.</p>
          </div>
          <button type="button" class="analysis-btn" id="analysis-btn">
            <span class="btn-text">Analyze current article</span>
            <span class="btn-loader hidden">Analyzing...</span>
          </button>
        </div>

        <!-- Loading State -->
        <div class="loading-state hidden" id="loading-state">
          <div class="loading-spinner"></div>
          <p>Analyzing article...</p>
          <div class="loading-steps">
            <div class="step active">Extracting content</div>
            <div class="step">Checking sources</div>
            <div class="step">Analyzing bias</div>
            <div class="step">Generating report</div>
          </div>
        </div>

        <!-- Results State -->
        <div class="results-state hidden" id="results-state">
          <!-- Current Article Status -->
          <div class="current-status">
            <div class="status-icon green" id="result-status-icon">üü¢</div>
            <div class="status-text">
              <span class="status-title" id="result-status-title">Article analyzed</span>
              <span class="status-subtitle" id="result-status-subtitle">Reliable source detected</span>
            </div>
          </div>

          <!-- Analyze Again Button -->
          <div class="analyze-again">
            <button type="button" class="analysis-btn secondary" id="analyze-again-btn">
              Analyze again
            </button>
          </div>

          <!-- Score Summary -->
          <div class="score-summary">
            <!-- AI score -->
            <div class="score-item">
              <span class="score-label">AI</span>
              <div class="score-bar">
                <div class="score-fill green" id="ai-score-fill" style="width: 0%"></div>
              </div>
              <span class="score-value" id="ai-score-value">0%</span>
            </div>

            <!-- Community score -->
            <div class="score-item">
              <span class="score-label">Community</span>
              <div class="score-bar">
                <div class="score-fill green" id="community-score-fill" style="width: 0%"></div>
              </div>
              <span class="score-value" id="community-score-value">0%</span>
            </div>

            <!-- Final results -->
            <div class="score-item final">
              <span class="score-label">Final</span>
              <div class="score-bar">
                <div class="score-fill green" id="final-score-fill" style="width: 0%"></div>
              </div>
              <span class="score-value" id="final-score-value">0%</span>
            </div>
          </div>

          <!-- Quick Explanation -->
          <div class="explanation">
            <p class="status-title">Details</p>
            <div class="explanation-items" id="explanation-items">
              <!-- Populated by JS -->
            </div>
          </div>

          <!-- Vote Buttons -->
          <p class="status-title">Your opinion</p><br/>
          <div class="vote-section">
            <button type="button" class="vote-btn vote-up" id="vote-up">
              <span class="vote-icon">üëç</span>
              <span class="vote-text">Reliable</span>
              <span class="vote-count" id="vote-up-count">0</span>
            </button>
            <button type="button" class="vote-btn vote-down" id="vote-down">
              <span class="vote-icon">üëé</span>
              <span class="vote-text">Suspicious</span>
              <span class="vote-count" id="vote-down-count">0</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Profile Tab Content -->
      <div class="tab-content hidden" id="profile-tab">
        <!-- User Info -->
        <div class="user-summary">
          <div class="user-avatar" id="user-avatar">üë§</div>
          <div class="user-details">
            <span class="user-name" id="user-name">User #1</span>
            <span class="user-level" id="user-level">Beginner</span>
          </div>
          <div class="user-points">
            <span class="points-value" id="points-value">0</span>
            <span class="points-label">pt(s)</span>
          </div>
        </div>

        <!-- Profile Management -->
        <div class="profile-actions">
          <button type="button" class="profile-btn" id="edit-profile-btn">Edit Profile</button>
          <button type="button" class="profile-btn secondary" id="change-password-btn">Change Password</button>
          <button type="button" class="profile-btn danger" id="signout-btn">Sign Out</button>
        </div>

        <!-- Quick Stats -->
        <div class="stats-compact">
          <div class="stat-item">
            <span class="stat-icon">üéØ</span>
            <span class="stat-number" id="stat-verified">0</span>
            <span class="stat-label">Verified</span>
          </div>
          <div class="stat-item">
            <span class="stat-icon">‚≠ê</span>
            <span class="stat-number" id="stat-reputation">0</span>
            <span class="stat-label">Reputation</span>
          </div>
          <div class="stat-item">
            <span class="stat-icon">üî•</span>
            <span class="stat-number" id="stat-streak">0</span>
            <span class="stat-label">Streak</span>
          </div>
        </div>

        <!-- Recent Badges -->
        <div class="badges-section">
          <h4>Recent Badges</h4>
          <div class="badges-list" id="badges-list">
            <span class="badge">üéñÔ∏è First Vote</span>
            <span class="badge">üìä Analyst</span>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <footer class="popup-footer">
        <button type="button" class="footer-btn" id="settings-btn" title="Settings">‚öôÔ∏è</button>
        <span class="version">v1.0</span>
        <button type="button" class="footer-btn" id="help-btn" title="Help">?</button>
      </footer>
    </div>
  </div>

  <!-- Edit Profile Modal -->
  <div class="modal hidden" id="edit-profile-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Edit Profile</h3>
        <button class="modal-close" id="edit-profile-close" type="button">&times;</button>
      </div>
      <div class="modal-body">
        <form id="edit-profile-form">
          <div class="form-group">
            <label for="edit-display-name">Display Name</label>
            <input type="text" id="edit-display-name" required>
          </div>
          <div class="form-group">
            <label for="edit-email">Email</label>
            <input type="email" id="edit-email" required readonly>
            <small class="form-help">Email cannot be changed</small>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn secondary" id="edit-profile-cancel" type="button">Cancel</button>
        <button class="btn primary" id="edit-profile-save" type="button">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Change Password Modal -->
  <div class="modal hidden" id="change-password-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Change Password</h3>
        <button class="modal-close" id="change-password-close" type="button">&times;</button>
      </div>
      <div class="modal-body">
        <form id="change-password-form">
          <div class="form-group">
            <label for="current-password">Current Password</label>
            <input type="password" id="current-password" required>
          </div>
          <div class="form-group">
            <label for="new-password">New Password</label>
            <input type="password" id="new-password" required minlength="6">
          </div>
          <div class="form-group">
            <label for="confirm-new-password">Confirm New Password</label>
            <input type="password" id="confirm-new-password" required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn secondary" id="change-password-cancel" type="button">Cancel</button>
        <button class="btn primary" id="change-password-save" type="button">Update Password</button>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="modal hidden" id="settings-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Settings</h3>
        <button class="modal-close" id="settings-close" type="button">&times;</button>
      </div>

      <div class="modal-body">
        <div class="setting-item">
          <label class="setting-label">
            <input type="checkbox" id="auto-analyze" checked>
            <span class="checkmark"></span>
            Auto-analyze articles
          </label>
          <p class="setting-description">Automatically analyze articles when you visit a page</p>
        </div>

        <div class="setting-item">
          <label class="setting-label">
            <input type="checkbox" id="show-notifications">
            <span class="checkmark"></span>
            Show notifications
          </label>
          <p class="setting-description">Display notifications for analysis results</p>
        </div>

        <div class="setting-item">
          <label class="setting-label">Analysis threshold</label>
          <input type="range" id="threshold-slider" min="0" max="100" value="70" class="slider">
          <span class="threshold-value">70%</span>
          <p class="setting-description">Minimum reliability score to show green indicator</p>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn secondary" id="settings-reset" type="button">Reset to Default</button>
        <button class="btn primary" id="settings-save" type="button">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Help Modal -->
  <div class="modal hidden" id="help-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Help & Information</h3>
        <button class="modal-close" id="help-close" type="button">&times;</button>
      </div>

      <div class="modal-body">
        <div class="help-section">
          <h4>üîç How it works</h4>
          <p>FactFlow analyzes web articles using AI and community feedback to determine reliability and detect potential bias.</p>
        </div>

        <div class="help-section">
          <h4>üìä Score Breakdown</h4>
          <ul>
            <li><strong>AI Score:</strong> Algorithm-based analysis of content quality and source reliability</li>
            <li><strong>Community Score:</strong> Aggregated votes from other users</li>
            <li><strong>Final Score:</strong> Weighted combination of both scores</li>
          </ul>
        </div>

        <div class="help-section">
          <h4>üéØ Indicators</h4>
          <div class="indicator-guide">
            <div class="indicator-item">
              <span class="indicator-color green"></span>
              <span>70-100%: Highly reliable</span>
            </div>
            <div class="indicator-item">
              <span class="indicator-color yellow"></span>
              <span>40-69%: Moderately reliable</span>
            </div>
            <div class="indicator-item">
              <span class="indicator-color red"></span>
              <span>0-39%: Low reliability</span>
            </div>
          </div>
        </div>
        
        <div class="help-section">
          <h4>üí° Tips</h4>
          <ul>
            <li>Always cross-reference with multiple sources</li>
            <li>Consider the publication date and context</li>
            <li>Vote honestly to help improve community scores</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <script src="popup.js"></script>
</body>
</html>